--[[
    Behavioral Protection Module
    Monitors and protects against suspicious player behavior
]]

function AntiExploit:DeployBehavioralProtection()
    print("[Protection] Deploying Behavioral Monitor...")
    
    -- Initialize player monitoring
    if not self.PlayerMonitoring then
        self.PlayerMonitoring = {}
    end
    
    -- Hook player events
    hook.Add("PlayerInitialSpawn", "AntiExploit_BehaviorInit", function(ply)
        local steamid = ply:SteamID64()
        
        if not AntiExploit.PlayerData then
            AntiExploit.PlayerData = {}
        end
        
        AntiExploit.PlayerData[steamid] = {
            join_time = CurTime(),
            commands = {},
            movements = {},
            chat_messages = {},
            network_activity = {},
            spawn_events = {},
            behavioral_score = 0,
            risk_level = "UNKNOWN"
        }
        
        -- Immediate threat check
        timer.Simple(1, function()
            if IsValid(ply) then
                AntiExploit:PerformInitialPlayerAssessment(ply)
            end
        end)
    end)
    
    hook.Add("PlayerSay", "AntiExploit_ChatMonitor", function(ply, text)
        local steamid = ply:SteamID64()
        
        if AntiExploit.PlayerData and AntiExploit.PlayerData[steamid] then
            table.insert(AntiExploit.PlayerData[steamid].chat_messages, {
                text = text,
                timestamp = CurTime()
            })
            
            -- Real-time chat analysis
            local chat_threat = AntiExploit:AnalyzeChatThreat(text, ply)
            if chat_threat.is_threat then
                AntiExploit:HandleAutonomousThreat("CHAT_THREAT", chat_threat)
            end
        end
    end)
    
    hook.Add("PlayerDisconnected", "AntiExploit_PlayerLeave", function(ply)
        local steamid = ply:SteamID64()
        
        timer.Simple(300, function() -- Clean up after 5 minutes
            if AntiExploit.PlayerData and AntiExploit.PlayerData[steamid] then
                AntiExploit.PlayerData[steamid] = nil
            end
        end)
    end)
    
    print("[Protection] âœ… Behavioral Monitor deployed")
end